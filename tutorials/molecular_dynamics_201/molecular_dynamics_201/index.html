



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Molecular Dynamics - Building input files, visualising the trajectory - Bioinformatics Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../extra.css">
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EMNLJD0DWP"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'G-EMNLJD0DWP');
</script>

    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#molecular-dynamics-tutorial-building-input-files-visualising-the-trajectory" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Bioinformatics Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Bioinformatics Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Molecular Dynamics - Building input files, visualising the trajectory
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/melbournebioinformatics/MelBioInf_docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    melbournebioinformatics/MelBioInf_docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Bioinformatics Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Bioinformatics Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/melbournebioinformatics/MelBioInf_docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    melbournebioinformatics/MelBioInf_docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tools and skill development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tools and skill development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../guides/bioinfo/" title="What is Bioinformatics?" class="md-nav__link">
      What is Bioinformatics?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../guides/galaxy/" title="Introduction to the Galaxy Platform" class="md-nav__link">
      Introduction to the Galaxy Platform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../galaxy-workflows/galaxy-workflows/" title="Introduction to Galaxy Workflows" class="md-nav__link">
      Introduction to Galaxy Workflows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python_overview/python_overview/" title="Introduction to Python" class="md-nav__link">
      Introduction to Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../using_git/Using_Git/" title="Introduction to Git and Github" class="md-nav__link">
      Introduction to Git and Github
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hpc/hpc/" title="Introduction to HPC" class="md-nav__link">
      Introduction to HPC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix/unix/" title="Introduction to Unix" class="md-nav__link">
      Introduction to Unix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro_R_biologists/intro_R_biologists/" title="Introduction to R for Biologists" class="md-nav__link">
      Introduction to R for Biologists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Genome_browsers/GenomeBrowsers_Intro/" title="Introduction to Genome Browsers" class="md-nav__link">
      Introduction to Genome Browsers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rna_seq_exp_design/rna_seq_experimental_design/" title="RNA-seq Experimental Design" class="md-nav__link">
      RNA-seq Experimental Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../docker/docker/" title="Containerized Bioinformatics" class="md-nav__link">
      Containerized Bioinformatics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cwl/cwl/" title="Common Workflow Language for Bioinformatics" class="md-nav__link">
      Common Workflow Language for Bioinformatics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bionitio/bionitio/" title="Command-line software development" class="md-nav__link">
      Command-line software development
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Genomics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Genomics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Variant detection
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Variant detection
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../var_detect_advanced/var_detect_advanced_background/" title="Introduction to Variant detection" class="md-nav__link">
      Introduction to Variant detection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variant_calling_galaxy_1/variant_calling_galaxy_1/" title="Variant Calling part 1 (Galaxy)" class="md-nav__link">
      Variant Calling part 1 (Galaxy)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../var_detect_advanced/var_detect_advanced/" title="Variant Calling part 2 (Galaxy)" class="md-nav__link">
      Variant Calling part 2 (Galaxy)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../longread_sv_calling/longread_sv_calling/" title="Long-read Structural Variant Calling" class="md-nav__link">
      Long-read Structural Variant Calling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      de novo assembly
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        de novo assembly
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../assembly/assembly-background/" title="Introduction to de novo assembly with Velvet" class="md-nav__link">
      Introduction to de novo assembly with Velvet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assembly/assembly-protocol/" title="Introduction to de novo genome assembly for Illumina reads" class="md-nav__link">
      Introduction to de novo genome assembly for Illumina reads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assembly/assembly/" title="de novo assembly of Illumina reads using Velvet (Galaxy)" class="md-nav__link">
      de novo assembly of Illumina reads using Velvet (Galaxy)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assembly/spades/" title="de novo assembly of Illumina reads using Spades (Galaxy)" class="md-nav__link">
      de novo assembly of Illumina reads using Spades (Galaxy)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pacbio/" title="de novo assembly of PacBio reads (unix)" class="md-nav__link">
      de novo assembly of PacBio reads (unix)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hybrid_assembly/nanopore_assembly/" title="Hybrid genome assembly - Nanopore and Illumina" class="md-nav__link">
      Hybrid genome assembly - Nanopore and Illumina
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Transcriptomics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Transcriptomics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../rna_seq_exp_design/rna_seq_experimental_design/" title="RNAseq Experimental Design" class="md-nav__link">
      RNAseq Experimental Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Bulk RNAseq
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Bulk RNAseq
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../rna_seq_dge_basic/rna_seq_basic_background/" title="Introduction to bulk RNAseq analysis" class="md-nav__link">
      Introduction to bulk RNAseq analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rna_seq_dge_basic/rna_seq_basic_tutorial/" title="RNAseq analysis using HISAT2 (Galaxy)" class="md-nav__link">
      RNAseq analysis using HISAT2 (Galaxy)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rna_seq_dge_basic/rna_seq_basic_tuxedo/" title="RNAseq analysis using Tuxedo (Galaxy)" class="md-nav__link">
      RNAseq analysis using Tuxedo (Galaxy)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rna_seq_dge_advanced/rna_seq_advanced_tutorial/" title="RNAseq differential expression tool comparision (Galaxy)" class="md-nav__link">
      RNAseq differential expression tool comparision (Galaxy)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rna_seq_dge_in_r/rna_seq_r/" title="RNAseq differential expression in R" class="md-nav__link">
      RNAseq differential expression in R
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Singlecell RNAseq
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Singlecell RNAseq
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../singlecell/" title="10X single-cell RNA-seq analysis in R" class="md-nav__link">
      10X single-cell RNA-seq analysis in R
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Proteomics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Proteomics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../proteomics_basic/proteomics_basic/" title="Identifying proteins from mass spectrometry data" class="md-nav__link">
      Identifying proteins from mass spectrometry data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proteomics_basic/background_data_formats/" title="Data Formats Background" class="md-nav__link">
      Data Formats Background
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proteomics_basic/background_protein_databases/" title="Protein Databases" class="md-nav__link">
      Protein Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proteomics_basic/background_search_engines/" title="Search Engines" class="md-nav__link">
      Search Engines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proteomics_basic/background_protein_prophet/" title="Protein Prophet" class="md-nav__link">
      Protein Prophet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Statistics and Visualisation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Statistics and Visualisation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python_viz/python_viz/" title="Data visualisation with Python" class="md-nav__link">
      Data visualisation with Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Structural Modelling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Structural Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../molecular_dynamics_101/molecular_dynamics_101/" title="Molecular Dynamics - Introduction to cluster computing" class="md-nav__link">
      Molecular Dynamics - Introduction to cluster computing
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Molecular Dynamics - Building input files, visualising the trajectory
      </label>
    
    <a href="./" title="Molecular Dynamics - Building input files, visualising the trajectory" class="md-nav__link md-nav__link--active">
      Molecular Dynamics - Building input files, visualising the trajectory
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" title="Learning Objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-overview" title="1 - Overview" class="md-nav__link">
    1 - Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-namd-overview" title="2 - NAMD overview" class="md-nav__link">
    2 - NAMD overview
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-recap-what-weve-done-so-far" title="a) Recap: what we've done so far" class="md-nav__link">
    a) Recap: what we've done so far
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-building-namd-input-files-overview" title="b) Building NAMD input files overview" class="md-nav__link">
    b) Building NAMD input files overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-the-namd_intermediate_template-directory-structure" title="c) The Namd_intermediate_template directory structure" class="md-nav__link">
    c) The Namd_intermediate_template directory structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-building-a-hiv-protease-model" title="3 - Building a HIV protease model" class="md-nav__link">
    3 - Building a HIV protease model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-preparing-the-configuration-files" title="4 - Preparing the configuration files" class="md-nav__link">
    4 - Preparing the configuration files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-edit-the-conf-files" title="a) Edit the .conf files" class="md-nav__link">
    a) Edit the .conf files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-edit-the-sbatch-scripts" title="b) Edit the sbatch scripts" class="md-nav__link">
    b) Edit the sbatch scripts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-launching-the-job-on-the-cluster" title="5 - Launching the job on the cluster" class="md-nav__link">
    5 - Launching the job on the cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-visualization-of-the-md-trajectory" title="6 - Visualization of the MD trajectory" class="md-nav__link">
    6 - Visualization of the MD trajectory
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-combining-the-trajectory-files" title="a) Combining the trajectory files" class="md-nav__link">
    a) Combining the trajectory files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-molecular-dynamics-trajectory-smoothing" title="b) Molecular dynamics trajectory smoothing" class="md-nav__link">
    b) Molecular dynamics trajectory smoothing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-centering-the-protein-for-analysis" title="c) Centering the protein for analysis" class="md-nav__link">
    c) Centering the protein for analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-using-volmap-to-map-ligand-density" title="d) Using Volmap to map ligand density." class="md-nav__link">
    d) Using Volmap to map ligand density.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" title="Learning Objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-overview" title="1 - Overview" class="md-nav__link">
    1 - Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-namd-overview" title="2 - NAMD overview" class="md-nav__link">
    2 - NAMD overview
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-recap-what-weve-done-so-far" title="a) Recap: what we've done so far" class="md-nav__link">
    a) Recap: what we've done so far
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-building-namd-input-files-overview" title="b) Building NAMD input files overview" class="md-nav__link">
    b) Building NAMD input files overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-the-namd_intermediate_template-directory-structure" title="c) The Namd_intermediate_template directory structure" class="md-nav__link">
    c) The Namd_intermediate_template directory structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-building-a-hiv-protease-model" title="3 - Building a HIV protease model" class="md-nav__link">
    3 - Building a HIV protease model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-preparing-the-configuration-files" title="4 - Preparing the configuration files" class="md-nav__link">
    4 - Preparing the configuration files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-edit-the-conf-files" title="a) Edit the .conf files" class="md-nav__link">
    a) Edit the .conf files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-edit-the-sbatch-scripts" title="b) Edit the sbatch scripts" class="md-nav__link">
    b) Edit the sbatch scripts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-launching-the-job-on-the-cluster" title="5 - Launching the job on the cluster" class="md-nav__link">
    5 - Launching the job on the cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-visualization-of-the-md-trajectory" title="6 - Visualization of the MD trajectory" class="md-nav__link">
    6 - Visualization of the MD trajectory
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-combining-the-trajectory-files" title="a) Combining the trajectory files" class="md-nav__link">
    a) Combining the trajectory files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-molecular-dynamics-trajectory-smoothing" title="b) Molecular dynamics trajectory smoothing" class="md-nav__link">
    b) Molecular dynamics trajectory smoothing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-centering-the-protein-for-analysis" title="c) Centering the protein for analysis" class="md-nav__link">
    c) Centering the protein for analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-using-volmap-to-map-ligand-density" title="d) Using Volmap to map ligand density." class="md-nav__link">
    d) Using Volmap to map ligand density.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/melbournebioinformatics/MelBioInf_docs/edit/master/docs/tutorials/molecular_dynamics_201/molecular_dynamics_201.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><img alt="" src="../../../img/melbioinf_logo.png" /></p>
<h1 id="molecular-dynamics-tutorial-building-input-files-visualising-the-trajectory">Molecular Dynamics Tutorial - Building input files, visualising the trajectory<a class="headerlink" href="#molecular-dynamics-tutorial-building-input-files-visualising-the-trajectory" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>In the following tutorials we will be logging on a high performance computer (HPC) to submit <a href="http://www.ks.uiuc.edu/Research/namd/">NAMD</a> molecular dynamics (MD) jobs and visualising the results with the molecular visualization program <a href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a>. As students have a vast range of skill levels and requirements, the tutorials are divided into two parts described below. Each tutorial is designed to be stand alone, start where you feel most comfortable and skip the exercises that are too simple.</p>
<ul>
<li>
<p><strong><a href="../molecular_dynamics_101/molecular_dynamics_101/">MD tutorial - Introduction to cluster computing</a></strong>: If you have never launched a job on a cluster before, this tutorial is for you. Here we will simply copy across a bare minimum directory containing input files ready to go for a short NAMD simulation. Once the job is finished, we will download the data to your local computer and visualize the trajectory with VMD.</p>
</li>
<li>
<p><strong>MD tutorial - Building input files (this tutorial)</strong>: In this tutorial we will be introducing a more sophisticated directory structure using scripts to direct the output and run the job. We initially download a copy of the directory to our local computer where we then build up the input files using VMD. We then upload this directory to the cluster where we submit the job. Finally we will download the results back to our local computer to visualize with VMD.</p>
</li>
</ul>
<h2 id="learning-objectives">Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<p>At the end of the course, you will be able to:</p>
<ul>
<li>Log onto a high performance computer cluster</li>
<li>Upload files to the cluster</li>
<li>Submit a basic molecular dynamics job on the cluster</li>
<li>Download the output and visualise the preliminary results</li>
</ul>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<p>This workshop is intended for scientists interested in learning the basics of running molecular dynamics on a HPC cluster.</p>
<p>It is recommended that participants attend Introduction to <a href="../../hpc/hpc/">High Performance Computing</a> prior to this workshop. If you are not familiar with using the command line, please also attend the <a href="../../unix/unix/">Introduction to Unix</a> workshop.</p>
<p>Please bring along your laptops with the following installed before arriving:</p>
<ul>
<li>VMD (<a href="http://www.ks.uiuc.edu/Research/vmd/">http://www.ks.uiuc.edu/Research/vmd/</a>)</li>
<li>Putty (<a href="https://www.putty.org/">https://www.putty.org/</a>) – only if you use Windows.</li>
</ul>
<p><strong>Important</strong>: NAMD has specific licencing requirements. Users are required to agree to these requirements to use NAMD on the Melbourne Bioinformatics HPC clusters. Login on <a href="https://my.vlsci.org.au/">https://my.vlsci.org.au/</a>, select &lsquo;Software agreement&rsquo;, &lsquo;Add software&rsquo;, &lsquo;NAMD&rsquo;.</p>
<blockquote>
<p><strong>Note</strong>: this tutorial describes the use of Snowy, but all these steps can be carried out on Barcoo by substituting every instance of <code class="codehilite"><span class="n">snowy</span></code> for <code class="codehilite"><span class="n">barcoo</span></code>.</p>
</blockquote>
<p><em>Tutorials created by Mike Kuiper, edited by Thomas Coudrat.</em></p>
<hr />
<h2 id="1-overview">1 - Overview<a class="headerlink" href="#1-overview" title="Permanent link">&para;</a></h2>
<p>The aim of this tutorial is to give more advanced lessons in setting up and preparing molecular dynamics jobs for submission to the HPC cluster. It is assumed that the user has a basic command of visualization programs such as VMD and has had at least some experience launching and retrieving example tutorial jobs to the cluster, as shown in <a href="../molecular_dynamics_101/molecular_dynamics_101/">our introductory molecular dynamics tutorial</a>.</p>
<blockquote>
<p><strong>Tip</strong>: in conjunction with this tutorial there are some excellent <a href="http://www.ks.uiuc.edu/Training/Tutorials/">NAMD tutorials</a> available that are worth working through.</p>
</blockquote>
<h2 id="2-namd-overview">2 - NAMD overview<a class="headerlink" href="#2-namd-overview" title="Permanent link">&para;</a></h2>
<h3 id="a-recap-what-weve-done-so-far">a) Recap: what we&rsquo;ve done so far<a class="headerlink" href="#a-recap-what-weve-done-so-far" title="Permanent link">&para;</a></h3>
<p>In the previous <a href="../molecular_dynamics_101/molecular_dynamics_101/">introductory tutorial</a> we simply launched a short job on the cluster that already had all the required input files to simulate a ubiquitin protein molecule in solution.</p>
<p>To run a molecular dynamics simulation on a cluster, the minimum files we need are:</p>
<p><code class="codehilite"><span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span><span class="p">.</span><span class="n">psf</span></code> - <strong>protein structure file</strong>. A list of the atoms, masses, charges and connections between atoms.</p>
<p><code class="codehilite"><span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span><span class="p">.</span><span class="n">pdb</span></code> - <strong>protein database file</strong>. The actual starting coordinates of the models. This has to be the same order as the psf file.</p>
<p><code class="codehilite"><span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span><span class="p">.</span><span class="n">conf</span></code> - <strong>NAMD configuration file</strong>. Tells NAMD how to run the job.</p>
<p><code class="codehilite"><span class="n">par_all27_prot_na</span><span class="p">.</span><span class="n">par</span></code> - <strong>a parameter file</strong>. (there are different types of these depending on the classes of molecules you have in your model, such as lipids or DNA). It is used by NAMD to run the simulation, basically a list of all the bonds, angles, dihedrals, improper and VdW terms.</p>
<p><code class="codehilite"><span class="n">sbatch_batchfile</span></code> - <strong>a script file</strong> to launch the job on the cluster depending on the scheduler used (i.e. PBS or Slurm). Tells the cluster how to run the NAMD job and how many cores to use.</p>
<p>In our <a href="../molecular_dynamics_101/molecular_dynamics_101/">introductory tutorial</a> all we had to do was launch the job. We will now go through the process of building a NAMD input files from scratch.</p>
<h3 id="b-building-namd-input-files-overview">b) Building NAMD input files overview<a class="headerlink" href="#b-building-namd-input-files-overview" title="Permanent link">&para;</a></h3>
<p>In order to build input files for NAMD, we will need a pdb file giving the initial coordinates. We usually get these files from the pdb database. These initial pdb files however are often not ideal, with missing residues and odd chain names making the process more complicated!</p>
<p>To generate NAMD input files, we will use the <strong>psfgen</strong> module within VMD, together with pdb and <strong>topology files</strong>, to generate a new pdb file and psf file.</p>
<p>In a flowchart, the process looks something like this:</p>
<p><img alt="" src="../media/namd_flowchart.png" /></p>
<h3 id="c-the-namd_intermediate_template-directory-structure">c) The <em>Namd_intermediate_template</em> directory structure<a class="headerlink" href="#c-the-namd_intermediate_template-directory-structure" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Note</strong>: one problem with running molecular dynamics simulations is that you can very quickly build up a mess of output files with the resulting directory becoming disorganized and difficult to navigate. (If you ran the <a href="../molecular_dynamics_101/molecular_dynamics_101/">introductory tutorial</a> you may have noticed a lot more files at the end of the run with no particular order!). One solution to this is to have specific directories for certain tasks and using scripts to redirect outputs.</p>
<p>In the next exercise we will download a template directory within which we will build our model and setup our simulation. We will use more sophisticated scripts to launch and manage our jobs that will direct output to appropriate directories.</p>
</blockquote>
<p>This directory is found on Snowy, under <strong>/vlsci/examples/namd/Namd_intermediate_template</strong>.</p>
<p>It has a particular directory structure as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">/</span><span class="nv">Namd_intermediate_template</span>

    <span class="nv">sbatch_start</span>            ← <span class="nv">script</span> <span class="nv">to</span> <span class="nv">start</span> <span class="nv">equilibration</span> <span class="nv">phase</span>
    <span class="nv">sbatch_production</span>       ← <span class="nv">script</span> <span class="nv">to</span> <span class="nv">start</span> <span class="nv">production</span> <span class="nv">phase</span>

    <span class="nv">sim_opt</span>.<span class="nv">conf</span>            ← <span class="nv">Namd</span> <span class="nv">configuration</span> <span class="nv">file</span> <span class="k">for</span> <span class="nv">optimization</span>
    <span class="nv">sim_production</span>.<span class="nv">conf</span>     ← <span class="nv">Namd</span> <span class="nv">configuration</span> <span class="nv">file</span> <span class="k">for</span> <span class="nv">production</span> <span class="nv">run</span>

    <span class="nv">project_plan</span>.<span class="nv">txt</span>        ← <span class="nv">A</span> <span class="nv">guide</span> <span class="nv">to</span> <span class="nv">thinking</span> <span class="nv">about</span> <span class="nv">your</span> <span class="nv">simulation</span>
    <span class="nv">counter</span>.<span class="nv">txt</span>             ← <span class="nv">File</span> <span class="k">for</span> <span class="nv">keeping</span> <span class="nv">track</span> <span class="nv">of</span> <span class="nv">job</span> <span class="nv">number</span>
    <span class="nv">max_jobnumber</span>.<span class="nv">txt</span>       ← <span class="nv">Defines</span> <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">jobs</span>

    <span class="o">/</span><span class="nv">BUILD_DIR</span>              ← <span class="nv">this</span> <span class="nv">is</span> <span class="nv">where</span> <span class="nv">we</span> <span class="nv">will</span> <span class="nv">build</span> <span class="nv">our</span> <span class="nv">models</span>

    <span class="o">/</span><span class="nv">Errors</span>                 ← <span class="nv">errors</span> <span class="nv">go</span> <span class="nv">here</span>

    <span class="o">/</span><span class="nv">Examples</span>               ← <span class="nv">find</span> <span class="nv">some</span> <span class="nv">example</span> <span class="nv">files</span> <span class="nv">here</span>

    <span class="o">/</span><span class="nv">InputFiles</span>             ← <span class="nv">our</span> <span class="nv">input</span> <span class="nv">files</span> <span class="nv">go</span> <span class="nv">here</span>
        <span class="o">/</span><span class="nv">Parameters</span>

    <span class="o">/</span><span class="nv">JobLog</span>                 ← <span class="nv">details</span> <span class="nv">of</span> <span class="nv">our</span> <span class="nv">running</span> <span class="nv">jobs</span> <span class="k">end</span> <span class="nv">up</span> <span class="nv">here</span>

    <span class="o">/</span><span class="nv">LastRestart</span>            ← <span class="k">If</span> <span class="nv">we</span> <span class="nv">need</span> <span class="nv">to</span> <span class="nv">restart</span> <span class="nv">a</span> <span class="nv">job</span>

    <span class="o">/</span><span class="nv">OutputFiles</span>            ← <span class="nv">Our</span> <span class="nv">NAMD</span> <span class="nv">output</span> <span class="nv">goes</span> <span class="nv">here</span>

    <span class="o">/</span><span class="nv">OutputText</span>             ← <span class="nv">Text</span> <span class="nv">output</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">job</span>

    <span class="o">/</span><span class="nv">RestartFiles</span>           ← <span class="nv">Generic</span> <span class="nv">restart</span> <span class="nv">files</span> <span class="nv">saved</span> <span class="nv">here</span>
</pre></div>
</td></tr></table>

<p>Rather than running one long job, this template is designed to run into smaller stages. After we build a model and make the appropriate changes to the input files the run is started by launching:</p>
<p><code class="codehilite"><span class="n">sbatch</span> <span class="n">sbatch_start</span></code>       <strong>(don&rsquo;t do this just yet!)</strong></p>
<p>This will launch a job using the <strong>sim_opt.conf</strong> configuration file which is designed to equilibrate the system. At the conclusion of the equilibration run, the script will automatically launch the production run: <strong>sbatch sbatch_production</strong></p>
<p>Production runs are designed to run less than 24 hours at a time, at the end of which <em>restart files</em> are saved and relaunch themselves for another 24 hour job. Every time they do, the script increases a <strong>counter.txt</strong> file by 1. Once that reaches the number in the <strong>MaxJobNumber.txt</strong> file, the job stops. For example, if a 24 hour job completes 5 nanoseconds of simulation a day, and we want a contiguous simulation of say 50 ns, then we&rsquo;d set the counter.txt file to 0 and the MaxJobNumber.txt to 10 and thus would expect the job to finish in 10 days. The advantage of running a series of smaller jobs rather than one long one is better scheduling on the cluster, and also better protection from data corruption should there be a hardware failure.</p>
<p>The script also date stamps and directs the output to the appropriate folders. A complete <strong>dcd trajectory</strong> can be reconstructed from the ordered files in the <strong>/OutputFile</strong> directory.</p>
<p>More of running a job later. First we need to build input files!</p>
<h2 id="3-building-a-hiv-protease-model">3 - Building a HIV protease model<a class="headerlink" href="#3-building-a-hiv-protease-model" title="Permanent link">&para;</a></h2>
<p><img alt="" src="../media/vmd_solvated.jpg" /></p>
<p>Download a copy of the <em>Namd_intermediate_template</em> to your <strong>local computer</strong>. We will prepare our files here and then upload them to the cluster once ready.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">scp</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nv">@snowy</span><span class="p">.</span><span class="n">vlsci</span><span class="p">.</span><span class="n">unimelb</span><span class="p">.</span><span class="n">edu</span><span class="p">.</span><span class="nl">au</span><span class="p">:</span><span class="o">/</span><span class="n">vlsci</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">namd</span><span class="o">/</span><span class="n">Namd_intermediate_template</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>
</td></tr></table>

<blockquote>
<p><strong>Note</strong>: don&rsquo;t forget the dot at the end</p>
</blockquote>
<p>Change into the build directory:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">cd</span> <span class="n">Namd_intermediate_template</span><span class="o">/</span><span class="n">BUILD_DIR</span>
</pre></div>
</td></tr></table>

<p>We are going to build a model of HIV protease which is a dimer of two 99 amino acids protein monomers. First we need to extract the two chains as separate pdb files. We will use the <a href="https://www.rcsb.org/structure/7HVP">RCSB entry 7hvp</a>. Download the pdb file by clicking on &ldquo;Download Files&rdquo; (right hand corner), PDB Format. On your <strong>local computer</strong> start VMD and load the newly downloaded 7hvp.pdb file by doing the following in the <strong>VMD main panel</strong>:</p>
<blockquote>
<p>File → New Molecule → Browse&hellip; → Load</p>
</blockquote>
<p>In this structure there are 3 “chains”. Chain <strong>A</strong> and <strong>B</strong> are the monomers and chain <strong>C</strong> is the inhibitor PRD_000228. Since there are water molecules associated with each chain selection we need to be more selective.</p>
<p>Highlight the protein selection in the <strong>VMD main panel</strong> and then click:</p>
<blockquote>
<p>File → save coordinates</p>
</blockquote>
<p>In the “selected atoms” box of the save trajectory window type:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">chain</span> <span class="n">A</span> <span class="k">and</span> <span class="n">protein</span>
</pre></div>
</td></tr></table>

<p>Save the chain as a pdb file with a sensible name and a pdb extension into <strong>BUILD_DIR</strong>. (e.g. 7hvp_chainA.pdb)</p>
<p>Repeat for chain B. Since the inhibitor is complicated we will leave chain C out for now for this exercise.
We should now have two pdb files in the <strong>/BUILD_DIR</strong> which will be the basis of our model building, i.e.:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mi">7</span><span class="n">hvp_chainA</span><span class="p">.</span><span class="n">pdb</span>
<span class="mi">7</span><span class="n">hvp_chainB</span><span class="p">.</span><span class="n">pdb</span>
</pre></div>
</td></tr></table>

<p>We now have to use a text editor to change the <strong>build_example</strong> script to point to these files. Open the <strong>build_example</strong> file with a text editor.</p>
<p>First thing to look for is that we are calling the right <strong>topology</strong> files. Since this example is only made from protein then the default topology file is fine (The _na part refers to nucleic acids).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">package</span> <span class="n">require</span> <span class="n">psfgen</span>
<span class="n">topology</span> <span class="p">..</span><span class="o">/</span><span class="n">InputFiles</span><span class="o">/</span><span class="k">Parameters</span><span class="o">/</span><span class="n">top_all27_prot_na</span><span class="p">.</span><span class="n">rtf</span>
</pre></div>
</td></tr></table>

<p>If we were to be building a model with a <strong>lipid bilayer</strong> we would need to also include the topology file referring to lipids, i.e.:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">topology</span> <span class="p">..</span><span class="o">/</span><span class="n">InputFiles</span><span class="o">/</span><span class="k">Parameter</span><span class="o">/</span><span class="n">top_all27_prot_lipid</span><span class="p">.</span><span class="n">rtf</span>
</pre></div>
</td></tr></table>

<p>We now need to change and add “segment” lines to point to our new pdb chains.</p>
<p>Edit:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">segment</span> <span class="n">A</span> <span class="err">{</span><span class="n">pdb</span> <span class="n">model_chainA</span><span class="p">.</span><span class="n">pdb</span><span class="err">}</span>
<span class="n">segment</span> <span class="n">B</span> <span class="err">{</span><span class="n">pdb</span> <span class="n">model_chainB</span><span class="p">.</span><span class="n">pdb</span><span class="err">}</span>
</pre></div>
</td></tr></table>

<p>to read:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">segment</span> <span class="n">A</span> <span class="err">{</span><span class="n">pdb</span> <span class="mi">7</span><span class="n">hvp_chainA</span><span class="p">.</span><span class="n">pdb</span><span class="err">}</span>
<span class="n">segment</span> <span class="n">B</span> <span class="err">{</span><span class="n">pdb</span> <span class="mi">7</span><span class="n">hvp_chainB</span><span class="p">.</span><span class="n">pdb</span><span class="err">}</span>
</pre></div>
</td></tr></table>

<p>We also need to change the “coordpdb” lines to reflect our new chains.</p>
<p>Edit:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">coordpdb</span> <span class="n">model_chainA</span><span class="p">.</span><span class="n">pdb</span> <span class="n">A</span>
<span class="n">coordpdb</span> <span class="n">model_chainB</span><span class="p">.</span><span class="n">pdb</span> <span class="n">B</span>
</pre></div>
</td></tr></table>

<p>to read:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">coordpdb</span> <span class="mi">7</span><span class="n">hvp_chainA</span><span class="p">.</span><span class="n">pdb</span> <span class="n">A</span>
<span class="n">coordpdb</span> <span class="mi">7</span><span class="n">hvp_chainB</span><span class="p">.</span><span class="n">pdb</span> <span class="n">B</span>
</pre></div>
</td></tr></table>

<p>Between the &lsquo;segment&rsquo; and &lsquo;coordpdb&rsquo; lines we can apply <strong>patches</strong> to make modifications to the protein. This is useful for example when adding disulphide bonds or phosphate groups or modifying the termini. We won&rsquo;t make any modifications for this example.</p>
<p>Save and close the <strong>build_example</strong> script. We will now see if we can build the model using VMD from the command line.</p>
<p>Type:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">vmd</span> <span class="o">-</span><span class="n">dispdev</span> <span class="nb">text</span> <span class="o">-</span><span class="n">e</span> <span class="n">build_example</span>          
</pre></div>
</td></tr></table>

<p><strong>You should see some errors.</strong></p>
<p>This is because in the original chains A and B there are some modified alanine residues labeled <strong>ABA</strong>. Since the residues ABA are not defined in the topology files, <strong>vmd psfgen</strong> does not know how to build this model. Edit the <strong>7hvp_chainA.pdb</strong> and <strong>7hvp_chainB.pdb</strong> files and carefully change any occurrence of <strong>ABA</strong> to <strong>ALA</strong>.</p>
<blockquote>
<p><strong>Note</strong>: spacing in pdb files is really important so don&rsquo;t mess it up!</p>
</blockquote>
<p>Re-run the above command. This should run vmd in text mode and read through the build script. If all goes well we should see 2 new files in the directory:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">model_temp_x</span><span class="p">.</span><span class="n">psf</span>
<span class="n">model_temp_x</span><span class="p">.</span><span class="n">pdb</span>
</pre></div>
</td></tr></table>

<blockquote>
<p><strong>Note</strong>: here we use a “_x” notation to specify temporary files.</p>
</blockquote>
<p>Next load these files into VMD. From <strong>BUILD_DIR</strong> start vmd:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">vmd</span> <span class="n">model_temp_x</span><span class="p">.</span><span class="n">psf</span> <span class="n">model_temp_x</span><span class="p">.</span><span class="n">pdb</span>
</pre></div>
</td></tr></table>

<p>We will now use the solvation module to center and create a solvent box around our protein. We will use dimensions of <code class="codehilite"><span class="mi">80</span> <span class="n">x</span> <span class="mi">64</span> <span class="n">x</span> <span class="mi">64</span></code> Å. Open the solvation window from the main panel:</p>
<blockquote>
<p>Extensions → Modeling → Add Solvation Box</p>
</blockquote>
<p>In this window do the following:</p>
<ul>
<li>toggle on the “rotate to minimize volume” button.</li>
<li>Change the Boundary number from “2.4” to “1.8”</li>
<li>untoggle the &lsquo;use molecular Dimensions” button.</li>
<li>In the Box Size add:<ul>
<li>min: x: -40 y: -32 z: -32</li>
<li>max: x: 40 y: 32 z: 32</li>
</ul>
</li>
<li>click “Solvate”</li>
</ul>
<p>We now should have two new files, <strong>solvate.psf</strong> and <strong>solvate.pdb</strong>, the solvated version of your original input. You should also your newly solvated system in the <strong>VMD display</strong>.</p>
<blockquote>
<p><strong>Tip</strong>: you can quickly hide &ldquo;model_temp_x.psf&rdquo; and &ldquo;model_temp_x.pdb&rdquo; from the VMD display by double-clicking on &lsquo;D&rsquo; (Drawn) next to these in the VMD main panel. This helps visualise the solvate.psf system.</p>
</blockquote>
<p>Now we can jump straight to adding ions. Adding ions makes the simulation more physiologically relevant and also balances charges. Open the ionization window:</p>
<blockquote>
<p>Extensions → Modeling → add ions</p>
</blockquote>
<p>In the <strong>“Autoionize”</strong> window simply toggle the “neutralize and set NaCl concentration” option and click “Autoionize”. We should get about 26 sodium ions and 30 chloride ions added to the system in two new files: <strong>ionized.psf</strong> and <strong>ionized.pdb</strong>.</p>
<p>These are are final input files. We should now rename and move these files to a better location in the directory structure. In Linux we can use the command:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mv</span> <span class="n">ionized</span><span class="p">.</span><span class="n">psf</span> <span class="p">..</span><span class="o">/</span><span class="n">InputFiles</span><span class="o">/</span><span class="n">hiv_protease</span><span class="p">.</span><span class="n">psf</span>
</pre></div>
</td></tr></table>

<p>and</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mv</span> <span class="n">ionized</span><span class="p">.</span><span class="n">pdb</span> <span class="p">..</span><span class="o">/</span><span class="n">InputFiles</span><span class="o">/</span><span class="n">hiv_protease</span><span class="p">.</span><span class="n">pdb</span>
</pre></div>
</td></tr></table>

<p>You can also now remove the old “solvate” and “_x” files to keep things tidy.</p>
<h2 id="4-preparing-the-configuration-files">4 - Preparing the configuration files<a class="headerlink" href="#4-preparing-the-configuration-files" title="Permanent link">&para;</a></h2>
<p>By now we have prepared two new input files for a NAMD simulation called <strong>hiv_protease.psf</strong> and <strong>hiv_protease.pdb</strong> and placed them in the folder <strong>/InputFiles</strong>. We now need to make changes to the NAMD configuration files to match our new inputs. In the main directory (Namd_intermediate_template) we have two configuration files and two sbatch files:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">sim_opt</span><span class="p">.</span><span class="n">conf</span>
<span class="n">sim_production</span><span class="p">.</span><span class="n">conf</span>
<span class="n">sbatch_start</span>
<span class="n">sbatch_production</span>
</pre></div>
</td></tr></table>

<h3 id="a-edit-the-conf-files">a) Edit the .conf files<a class="headerlink" href="#a-edit-the-conf-files" title="Permanent link">&para;</a></h3>
<p>Let us first edit the <strong>.conf</strong> files. Open the <strong>sim_opt.conf</strong> file.</p>
<p>You can see that these two lines match our inputs (change them if you used a different name of the psf and pdb files):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">structure</span>   <span class="n">InputFiles</span><span class="o">/</span><span class="n">hiv_protease</span><span class="p">.</span><span class="n">psf</span>
<span class="n">coordinates</span> <span class="n">InputFiles</span><span class="o">/</span><span class="n">hiv_protease</span><span class="p">.</span><span class="n">pdb</span>
</pre></div>
</td></tr></table>

<p>The next thing we have to watch is that we have an appropriate parameter file pointed to. Since we have a simple protein model the default parameter file should be fine:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">paraTypeCharmm</span>  <span class="k">on</span>
<span class="k">parameters</span>      <span class="n">InputFiles</span><span class="o">/</span><span class="k">Parameters</span><span class="o">/</span><span class="n">par_all27_prot_na</span><span class="p">.</span><span class="n">prm</span>
</pre></div>
</td></tr></table>

<p>If we were running lipids in the simulation or used a separately parameterized ligand we would add a few extra lines here, say for example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">parameters</span>  <span class="n">InputFiles</span><span class="o">/</span><span class="k">Parameters</span><span class="o">/</span><span class="n">par_all27_prot_lipid</span><span class="p">.</span><span class="n">prm</span>
<span class="k">parameters</span>  <span class="n">InputFiles</span><span class="o">/</span><span class="k">Parameters</span><span class="o">/</span><span class="n">par_for_ligand</span><span class="p">.</span><span class="n">prm</span>
</pre></div>
</td></tr></table>

<p>We also need to make changes to match our <strong>periodic boundary conditions</strong> (PBC).</p>
<p>The way PBC works is that our simulation box has a certain rectangular geometry which is mirrored on all sides to mimic an infinite system. A molecule which falls out of the left and side of the box fall back in on the right hand side. A molecule that falls out of the bottom reappears at the top and so on. Care has to be given when building a solvated PBC system so that a protein molecule has enough room around its edges so that it doesn&rsquo;t interact with itself should it wander too close to a boundary.</p>
<p>Since our box ended up being of dimensions 80 x 64 x 64 Å, this is reflected in the PBC parameters here:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">cellBasisVector1</span>   <span class="mi">80</span><span class="p">.</span>  <span class="mi">0</span><span class="p">.</span>  <span class="mi">0</span><span class="p">.</span>
<span class="n">cellBasisVector2</span>    <span class="mi">0</span><span class="p">.</span> <span class="mi">64</span><span class="p">.</span>  <span class="mi">0</span><span class="p">.</span>
<span class="n">cellBasisVector3</span>    <span class="mi">0</span><span class="p">.</span>  <span class="mi">0</span><span class="p">.</span> <span class="mi">64</span><span class="p">.</span>
<span class="n">cellOrigin</span>          <span class="mi">0</span>   <span class="mi">0</span>   <span class="mi">0</span>
</pre></div>
</td></tr></table>

<p>That should do it for the optimization configuration file. The idea of the optimization phase is to equilibrate your simulation and allow it to settle before running production runs. Typically we run this with a NPT ensemble, (whereby the number of particles (N) pressure (P) and temperature (T) remain constant). The volume is allowed to change as water and lipids can find their optimal density. At the end of the optimization phase, the sbatch_start script takes the generic output of the run and renames it to pass on to the production phase of the simulation. The sbatch_script will automatically launch the production phase on successful completion of the optimization phase.</p>
<p>The <strong>sim_production.conf</strong> file controls how we run a segment of the production phase including the type of simulation and how long it runs. The file <strong>MaxJobNumber.txt</strong> determines how many times this production script is run. Each time a production segment finishes, output is date-stamped and placed in appropriate folders, while restart files are written, ready to launch the next segment. The number in the file counter.txt is increased by 1 to keep track of the jobs. Typically we aim to keep these segments running less than 24 hours at a time. This has a number of advantages, firstly, if the machine should have a failure the most you will loose is one days simulation which is easy to recover from the last restart file. Secondly, this strategy helps with efficiently filling the machine with jobs and keeping your groups quota available. Long jobs scheduled for weeks can tie up resources, quota and risk losing all the generated data should there be a failure in that time.</p>
<p>Open the <strong>sim_production.conf</strong> file:</p>
<p>Since we would like to run a relatively short job segment for this exercise, we will change the line:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">set</span> <span class="n">NumberSteps</span> <span class="mi">2500</span>
</pre></div>
</td></tr></table>

<p>to:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">set</span> <span class="n">NumberSteps</span> <span class="mi">20000</span>
</pre></div>
</td></tr></table>

<p>This segment will run for only 20,000 x 2 fs = 0.04 ns at a time. For example, if we set max_jobnumber.txt to be 5 then we will should get 0.2 ns worth of simulation.</p>
<p>Edit the <strong>counter.txt</strong> file to contain the number 0. (The counter file is a way of running a certain number of jobs. This increments up after each job finished until it reaches the same as MaxJobNumber.txt and then stops). In linux we can simply use:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="n">counter</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table>

<p>Then edit the <strong>MaxJobNumber.txt</strong> file to contain the number 5. This will limit the total number of jobs run. Jobs will stop when counter.txt value is equal to or greater than the MaxJobNumber.txt value.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">echo</span> <span class="mi">5</span> <span class="o">&gt;</span> <span class="n">MaxJobNumber</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table>

<p>We can always make this number bigger later and restart the jobs if we want things to go longer.</p>
<p>For this short example we will also change more lines in the <strong>sim_production.conf</strong> file:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">restartfreq</span>     <span class="mi">2500</span>
<span class="n">dcdfreq</span>         <span class="mi">5000</span>
<span class="n">xstFreq</span>         <span class="mi">5000</span>
<span class="n">outputEnergies</span>  <span class="mi">5000</span>
<span class="n">outputPressure</span>  <span class="mi">5000</span>
<span class="n">outputTiming</span>    <span class="mi">5000</span>
</pre></div>
</td></tr></table>

<p>to:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">restartfreq</span>     <span class="mi">25000</span>
<span class="n">dcdfreq</span>         <span class="mi">5000</span>
<span class="n">xstFreq</span>         <span class="mi">5000</span>
<span class="n">outputEnergies</span>  <span class="mi">5000</span>
<span class="n">outputPressure</span>  <span class="mi">5000</span>
<span class="n">outputTiming</span>    <span class="mi">5000</span>
</pre></div>
</td></tr></table>

<p>We don&rsquo;t have to change the periodic boundary conditions in the <strong>sim_production.conf</strong> file as we read in the restart files from the previous simulation namely:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">set</span> <span class="n">inputname</span> <span class="n">generic_restartfile</span>
<span class="n">binCoordinates</span> <span class="err">$</span><span class="n">inputname</span><span class="p">.</span><span class="n">coor</span>  <span class="p">;</span> <span class="o">#</span> <span class="n">Coordinates</span> <span class="k">from</span> <span class="k">last</span> <span class="n">run</span> <span class="p">(</span><span class="nb">binary</span><span class="p">)</span>
<span class="n">binVelocities</span>  <span class="err">$</span><span class="n">inputname</span><span class="p">.</span><span class="n">vel</span>   <span class="p">;</span> <span class="o">#</span> <span class="n">Velocities</span> <span class="k">from</span> <span class="k">last</span> <span class="n">run</span> <span class="p">(</span><span class="nb">binary</span><span class="p">)</span>
<span class="n">extendedSystem</span> <span class="err">$</span><span class="n">inputname</span><span class="p">.</span><span class="n">xsc</span>   <span class="p">;</span> <span class="o">#</span> <span class="n">Cell</span> <span class="n">dimensions</span> <span class="k">from</span> <span class="k">last</span> <span class="n">run</span>
</pre></div>
</td></tr></table>

<p>There are a number of other control parameters in the production configuration script worth taking a look at including such things as cutoffs and temperature controls if you have time. These don&rsquo;t change much typically between simulations, but are covered better in the online NAMD tutorials and manuals. The setting we use here are reasonable default values.</p>
<p>Save and close your <strong>.conf</strong> files.</p>
<h3 id="b-edit-the-sbatch-scripts">b) Edit the sbatch scripts<a class="headerlink" href="#b-edit-the-sbatch-scripts" title="Permanent link">&para;</a></h3>
<p>The sbatch scripts tell the cluster how to run the simulation and how to handle the generated data. These scripts are a lot more complicated than the ones we saw in the <a href="../molecular_dynamics_101/molecular_dynamics_101/">introductory tutorial</a>, but most of the details you need to worry about are all in the first few lines.</p>
<p>In a sbatch script we need to pass arguments to the Slurm scheduler (the controlling program which launches users jobs to the cluster). The way to do so is use a complete code word “#SBATCH” on the first spaces of a line:</p>
<p><code class="codehilite"><span class="o">#</span><span class="n">SBATCH</span> <span class="c1">--nodes=2</span></code>         ← this works!</p>
<p><code class="codehilite"><span class="o">#</span> <span class="n">SBATCH</span> <span class="c1">--nodes=2</span></code>        ← this doesn&rsquo;t because of the space between “#” and “SBATCH”</p>
<blockquote>
<p><strong>Note</strong>:</p>
<ul>
<li>
<p>people often get confused with this as the “<strong>#</strong>” symbol usually denotes a comment line.</p>
</li>
<li>
<p>PBS scripts work in a similar way, but with the code word “<strong>#PBS</strong>”</p>
</li>
</ul>
</blockquote>
<p>Set the number of nodes used for a job on <strong>sbatch_start</strong> and <strong>sbatch_production</strong> to 4, as shown below:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">#</span><span class="n">SBATCH</span> <span class="c1">--nodes=4</span>
</pre></div>
</td></tr></table>

<p><strong>Remember, more nodes is not necessarily faster and can be dramatically slower!</strong> It can be a good way to quickly burn up your quota inefficiently. It is a good idea to benchmark your jobs to find an optimal sweet spot, - more of how to do that another time. 4 nodes for this example will be fine.</p>
<p>To set the production job runtime change this line on <strong>sbatch_production</strong>:</p>
<p><code class="codehilite"><span class="o">#</span><span class="n">SBATCH</span> <span class="c1">--time=2:0:0</span></code>         ← (hours:minutes:seconds)</p>
<p>The time or “walltime” tells the cluster how long your job should run. If your job runs longer than this, it will be stopped. As rule of thumb, use the time you expect plus 10%.  If you use an excessively long walltime such as days or weeks, the scheduler may take a long time to fit your job into the queue. Generally shorter jobs will get on the cluster faster (but make sure your walltime is appropriate for your configuration file!).</p>
<h2 id="5-launching-the-job-on-the-cluster">5 - Launching the job on the cluster<a class="headerlink" href="#5-launching-the-job-on-the-cluster" title="Permanent link">&para;</a></h2>
<p>We are now ready to go ahead with launching the job. For convenience I prefer to keep everything associated with the simulation together in the one directory in including all the build scripts and parameter files. The size of the extra files is tiny compared to the data you generate but this way you can ensure to totally replicate and finding that you happen to make.</p>
<p>Upload the entire directory to your account. Under Linux this might be:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">scp</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="n">Namd_intermediate_template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nv">@snowy</span><span class="p">.</span><span class="n">vlsci</span><span class="p">.</span><span class="n">unimelb</span><span class="p">.</span><span class="n">edu</span><span class="p">.</span><span class="nl">au</span><span class="p">:</span><span class="w"></span>
</pre></div>
</td></tr></table>

<p>Log into your account on <strong>Snowy</strong> and change into the top of the <em>Namd_intermediate_template/</em> directory:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ssh</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nv">@snowy</span><span class="p">.</span><span class="n">vlsci</span><span class="p">.</span><span class="n">unimelb</span><span class="p">.</span><span class="n">edu</span><span class="p">.</span><span class="n">au</span><span class="w"></span>
</pre></div>
</td></tr></table>

<p>Launch the start script:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">sbatch</span> <span class="n">sbatch_start</span>
</pre></div>
</td></tr></table>

<p>This should launch the equilibration phase of the simulation. As mentioned previously, the sbatch_script will automatically direct the output to the proper directories and launch the production phase. <strong>This might take an hour or two to complete</strong>.</p>
<p>All text output is directed to the <strong>/OutputText</strong> folder. You can take a peek at how your job is going by using the command <code class="codehilite"><span class="n">tail</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span></code> which prints out the last few lines of <code class="codehilite"><span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span></code>.</p>
<p><strong>For the purpose of this exercise</strong>, we will stop the job early and copy across a pre-computed data set. In your directory you should see slurm output file.</p>
<p>It will look something like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">slurm</span><span class="o">-</span><span class="mi">123456</span><span class="p">.</span><span class="k">out</span>
</pre></div>
</td></tr></table>

<p>The number represents the job number on the cluster. Now use <strong>scancel</strong> to stop that job (i.e. for above you would use: <strong>scancel 123456</strong>).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">scancel</span> <span class="o">&lt;</span><span class="n">jobnumber</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table>

<p>Now that your job has finished, we will copy across a completed job run. From your <strong>top directory</strong> on Snowy:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">vlsci</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">namd</span><span class="o">/</span><span class="n">Namd_intermediate_template_finished</span><span class="cm">/* Namd_intermediate_template/</span>
</pre></div>
</td></tr></table>

<p>Once the jobs are finished (or you have stopped the jobs and copied across the precomputed data), we can download the entire directory back to our local computer for analysis. If you don&rsquo;t have much memory on your laptop, you can do the analysis remotely on the cluster.</p>
<p>A smart way to copy files back to your local computer is to use <strong>rsync</strong>. This way you only copy new or changed files back to your computer. In Linux from the local computer terminal this would be:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">rsync</span><span class="w"> </span><span class="o">-</span><span class="n">avzt</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nv">@snowy</span><span class="p">.</span><span class="n">vlsci</span><span class="p">.</span><span class="n">unimelb</span><span class="p">.</span><span class="n">edu</span><span class="p">.</span><span class="nl">au</span><span class="p">:</span><span class="n">Namd_intermediate_template</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>
</td></tr></table>

<blockquote>
<p><strong>Note</strong>: the dot is important!</p>
</blockquote>
<p>Now that you have your data, we are ready to visualize the results.</p>
<h2 id="6-visualization-of-the-md-trajectory">6 - Visualization of the MD trajectory<a class="headerlink" href="#6-visualization-of-the-md-trajectory" title="Permanent link">&para;</a></h2>
<p>Hopefully by now you have successfully built a model, completed a small run with the template directory on the cluster and downloaded the results on to your local computer. We will now have a look at the data you generated.</p>
<blockquote>
<p><strong>Note</strong>: if for some reason you didn&rsquo;t manage to run a successful MD simulation, you can copy a directory containing the precomputed data from the folowing Snowy folder: <strong>/vlsci/examples/namd/Namd_intermediate_template_finished</strong>. You can do this with the command below:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">scp</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nv">@snowy</span><span class="p">.</span><span class="n">vlsci</span><span class="p">.</span><span class="n">unimelb</span><span class="p">.</span><span class="n">edu</span><span class="p">.</span><span class="nl">au</span><span class="p">:</span><span class="o">/</span><span class="n">vlsci</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">namd</span><span class="o">/</span><span class="n">Namd_intermediate_template_finished</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
</blockquote>
<h3 id="a-combining-the-trajectory-files">a) Combining the trajectory files<a class="headerlink" href="#a-combining-the-trajectory-files" title="Permanent link">&para;</a></h3>
<p>When we run segmented jobs as in this template, we end up with a series of output files in <strong>/OutputFiles</strong> such as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">train01@snowy OutputFiles</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">lrt</span><span class="w">  </span>
<span class="n">total</span><span class="w"> </span><span class="mi">13184</span><span class="w"></span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">train01</span><span class="w"> </span><span class="n">TRAINING</span><span class="w">    </span><span class="mi">1477</span><span class="w"> </span><span class="n">Mar</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">18</span><span class="w"> </span><span class="n">create_dcd_loader_script</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING 4090120 Mar 21 10:45 opt.2017-03-21-10.19.sim_opt_r1.dcd.x</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING 1859296 Mar 21 10:51 2017-03-21-10.45.NamdJob_round01.0.dcd</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING 1859296 Mar 21 10:57 2017-03-21-10.51.NamdJob_round01.1.dcd</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING 1859296 Mar 21 11:03 2017-03-21-10.57.NamdJob_round01.2.dcd</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING 1859296 Mar 21 11:09 2017-03-21-11.03.NamdJob_round01.3.dcd</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING 1859296 Mar 21 11:15 2017-03-21-11.09.NamdJob_round01.4.dcd</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING     195 Mar 21 11:15 dcd_list.txt</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 train01 TRAINING     742 Mar 21 11:15 combined_dcd_file_loader.vmd</span>
</pre></div>
</td></tr></table>

<p>The main output files have the <strong>.dcd</strong> extension. We can see that things went well as the sizes of these files are identical as expected.</p>
<p>If you have a lot of these files, it can be tedious to read them into VMD. Luckily we can run a script from this directory (you can do this on the cluster if you are running Windows on your local computer) to generate a list of this output to be read in by VMD. Simply run:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">create_dcd_loader_script</span>
</pre></div>
</td></tr></table>

<p>This creates the file: <strong>combined_dcd_file_loader.vmd</strong></p>
<p>From the main directory on your local computer, we can load in our trajectory using:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">vmd</span> <span class="n">InputFiles</span><span class="o">/</span><span class="n">hiv_protease</span><span class="p">.</span><span class="n">psf</span> <span class="n">InputFiles</span><span class="o">/</span><span class="n">hiv_protease</span><span class="p">.</span><span class="n">pdb</span>
</pre></div>
</td></tr></table>

<p>then from the main panel:</p>
<blockquote>
<p>File → Load Visualization State → /OutputFiles/combined_dcd_file_loader.vmd</p>
</blockquote>
<p>Click on the &ldquo;play&rdquo; button at the bottom right hand corner of the VMD main panel and watch the simulation run!</p>
<blockquote>
<p><strong>Note</strong>: it is possible to restart the simulations of any segment as the restart files are saved under <strong>/RestartFiles</strong>.</p>
</blockquote>
<h3 id="b-molecular-dynamics-trajectory-smoothing">b) Molecular dynamics trajectory smoothing<a class="headerlink" href="#b-molecular-dynamics-trajectory-smoothing" title="Permanent link">&para;</a></h3>
<p>The MD example presented here has not run for a particularly long period of time, barely a few hundred picoseconds, thus the relative movement in the molecule is small. For simulations that run on longer timescales there will be an amount of drifting making the analysis and visualization difficult.</p>
<p>Luckily, there is an easy way to center and visualize our simulations which we will cover next. Now display only the protein backbone, in the VMD main panel:</p>
<blockquote>
<p>Graphics → Representations&hellip;</p>
</blockquote>
<p>In the graphical representations window:</p>
<blockquote>
<p>Selected Atoms (protein) + Drawing method (NewRibbons)</p>
</blockquote>
<p>You may notice the protein jiggles around when you play the trajectory. This is Brownian motion, and this is more prominent in longer sampling.</p>
<p>The first thing we might try to ease the jiggling is to increase the <strong>trajectory smoothing window size</strong>. In the VMD Graphical representations window, select your protein representation and toggle the <strong>Trajectory</strong> tab. At the bottom of the tab, increase the Trajectory Smoothing value to 5 and replay the trajectory. This should be much smoother. Try increasing to higher values.</p>
<p>Although this view is smoother, it still can be difficult to visualize what relative motion is going on, due to the motion of the protein in the simulation box.</p>
<h3 id="c-centering-the-protein-for-analysis">c) Centering the protein for analysis<a class="headerlink" href="#c-centering-the-protein-for-analysis" title="Permanent link">&para;</a></h3>
<p>We will now use the <strong>RMSD Trajectory Tool</strong> to center our protein frames.</p>
<p>In the VMD main panel, open:</p>
<blockquote>
<p>Extensions → Analysis → RMSD Trajectory Tool</p>
</blockquote>
<p>This should open up a new window. Towards the top left we have the selection, for the &lsquo;Selection modifiers&rsquo; tick &lsquo;Backbone&rsquo;. In the top right, click <strong>“RMSD”</strong>.</p>
<p>When you do so, it will calculate the RMSD, of the protein backbone over the course of the simulation. The average value can be quite large depending on how much your selection drifts through space. At this point nothing has changed in the trajectory yet.</p>
<p>Next, click the <strong>“ALIGN”</strong> button. This will translate each frame to minimize the RMSD of the selection based on the first frame (in this case, our original input files).</p>
<p>In other words, the protein has been centered on a reference frame, but now the water box appears to rotate about the axis. This makes it much more useful for analysis.</p>
<p>Click <strong>“RMSD”</strong> again and you&rsquo;ll see the value becomes much smaller.</p>
<h3 id="d-using-volmap-to-map-ligand-density">d) Using Volmap to map ligand density.<a class="headerlink" href="#d-using-volmap-to-map-ligand-density" title="Permanent link">&para;</a></h3>
<p>Now that we have a nicely centered protein dataset we can do something useful like plot the water density. In the VMD main panel, open:</p>
<blockquote>
<p>Extensions → Analysis → VolMap Tool</p>
</blockquote>
<p>A new VolMap window should open up.</p>
<p>In the selection box type: “water” and tick the box “compute for all frames”, click &ldquo;Create Map&rdquo;.</p>
<p>This will calculate a density map based on your water selection and create a new graphical selection. You should see a big white box around your molecule. Open up your graphical representation window and select the new <strong>“Isosurface”</strong> representation. Under the “Draw style” tab use the Isovalue slider to scale back the density to just a few points (try 1.2).</p>
<p>What you are seeing here are bound water molecules relative to the protein structure. These water molecules stay relatively still compared to the bulk water so create an area of high water density. These can be quite important for drug interactions, protein stability and catalytic centers. We often don&rsquo;t display waters in simulations for clarity, and often forget that they are there.</p>
<p>If all goes well you might see something like this. The red and blue lines are the chains of the protein, the cyan blobs are regions of high water density averaged from the longer simulation.</p>
<p><img alt="" src="../media/vmd_volmap.jpg" /></p>
<blockquote>
<p><strong>Exercise</strong>: see if you can identify any ordered waters near the catalytic residues of HIV protease (Asp 25). You may change the resolution of Volmap to 0.5 for more detail.</p>
</blockquote>
<p>You can also do this sort of view for ligands to show where they bind. Always make sure you first center your target protein or else this sort of representation will not make sense!</p>
<p>So concludes the intermediate tutorial.</p>
<blockquote>
<p><strong>Note</strong>: a more advanced template that can be used to organise the MD simulations ran on HPC clusters called <a href="https://github.com/mkuiper/MD_workflow_py">MD_workflow_py</a> was written with using the Python programming language. This new workflow uses a similar structure to what was shown in this tutorial and has additional capability to manage thousands of independent jobs and generate molecular animations.</p>
</blockquote>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../molecular_dynamics_101/molecular_dynamics_101/" title="Molecular Dynamics - Introduction to cluster computing" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Molecular Dynamics - Introduction to cluster computing
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a href="https://www.melbournebioinformatics.org.au/">Melbourne Bioinformatics</a>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>